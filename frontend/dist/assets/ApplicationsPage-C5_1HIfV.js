var e=(e,t,n)=>new Promise((r,s)=>{var a=e=>{try{o(n.next(e))}catch(t){s(t)}},i=e=>{try{o(n.throw(e))}catch(t){s(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,i);o((n=n.apply(e,t)).next())});import{u as t,c as n,i as r,j as s,e as a,A as i}from"./index-nVrMVh79.js";import{r as o}from"./react-vendor-Ct6ux_Fb.js";import{I as l,_ as d,F as c,s as p,T as x,R as u,b as h,c as m,p as g,a as y,B as f,n as j,d as b,m as v,j as S,q as w,E as C,M as k,f as T,S as D,l as z,L as I}from"./antd-DWkf5yY6.js";import{R as _}from"./SaveOutlined-hbZEYkY4.js";import{u as R,c as E}from"./router-BjWxKEch.js";import{R as L}from"./ArrowLeftOutlined-BaCjY7kl.js";import"./axios-DpZCZaHO.js";var A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},F=function(e,t){return o.createElement(l,d({},e,{ref:t,icon:A}))},O=o.forwardRef(F);const{Option:B}=m,{TextArea:M}=y,{Title:P,Text:W}=x,q=e=>{if(!e)return(new Date).toISOString().split("T")[0];try{return e.split("T")[0]}catch(t){return(new Date).toISOString().split("T")[0]}};function H({onSave:i,onCancel:l,loading:d,preselectedCompany:x}){const{user:y,student:b}=t(),[v]=c.useForm(),[S,w]=o.useState([]),[C,k]=o.useState([]),[T,D]=o.useState(null),[z,I]=o.useState(!1),[R,E]=o.useState(!1);o.useEffect(()=>{L()},[]),o.useEffect(()=>{x&&E(!1)},[x]),o.useEffect(()=>{if(x&&S.length>0&&!R){const e=x.id;v.setFieldsValue({company:e}),D(e),A(e),E(!0)}},[x,S,v,R]);const L=()=>e(this,null,function*(){I(!0);try{const e=yield n.getCompanies();w(e.results||[])}catch(e){p.error("Ошибка при загрузке компаний")}finally{I(!1)}}),A=t=>e(this,null,function*(){if(D(t),t)try{const e=yield r.getInternships({company:t});k(e.results||[])}catch(e){p.error("Ошибка при загрузке практик компании")}else k([])}),F=()=>{v.resetFields(),D(null),k([]),E(!0)};return s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{marginBottom:"24px",textAlign:"center"},children:[s.jsx(P,{level:3,style:{margin:0,color:"#2d3748"},children:"Новая заявка"}),s.jsx(W,{type:"secondary",style:{fontSize:"16px"},children:"Заполните форму для подачи заявки на практику"})]}),s.jsxs(c,{form:v,layout:"vertical",onFinish:t=>e(this,null,function*(){var e,n;try{if(!y||!b)return void p.error("Необходимо войти в систему для создания заявки");const e=yield a.createApplication({internship:t.internship,comment:t.comment}),n=S.find(e=>e.id===t.company),r=C.find(e=>e.id===t.internship);!e.id||!e.company_name||e.position_name;const s={id:e.id,company:e.company_name||(null==n?void 0:n.name)||"Загрузка...",position:e.position_name||(null==r?void 0:r.position)||"Загрузка...",status:e.status||"pending",appliedDate:q(e.applied_date||e.created_at),description:e.comment||t.comment||""};p.success("Заявка успешно создана!"),F(),i(s)}catch(r){p.error(`Ошибка при создании заявки: ${(null==(n=null==(e=r.response)?void 0:e.data)?void 0:n.detail)||r.message||"Неизвестная ошибка"}`)}}),size:"large",children:[s.jsxs(u,{gutter:[16,0],children:[s.jsx(h,{xs:24,sm:12,children:s.jsx(c.Item,{name:"company",label:"Компания",rules:[{required:!0,message:"Выберите компанию"}],children:s.jsx(m,{placeholder:"Выберите компанию",loading:z,onChange:A,showSearch:!0,filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),children:S.map(e=>s.jsx(B,{value:e.id,children:e.name},e.id))})})}),s.jsx(h,{xs:24,sm:12,children:s.jsx(c.Item,{name:"internship",label:"Практика",rules:[{required:!0,message:"Выберите практику"}],children:s.jsx(m,{placeholder:"Выберите практику",disabled:!T,showSearch:!0,filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),optionLabelProp:"label",children:C.map(e=>s.jsx(B,{value:e.id,label:e.position,children:s.jsxs("div",{style:{padding:"4px 0"},children:[s.jsx("div",{style:{display:"flex",alignItems:"center",marginBottom:"2px"},children:s.jsx(W,{strong:!0,style:{fontSize:"14px"},children:e.position})}),s.jsxs("div",{style:{display:"flex",gap:"8px",fontSize:"12px",color:"#999"},children:[e.location&&s.jsxs("span",{children:[s.jsx(O,{style:{marginRight:"4px"}}),e.location]}),e.start_date&&e.end_date&&s.jsxs("span",{children:[s.jsx(g,{style:{marginRight:"4px"}}),new Date(e.start_date).toLocaleDateString()," - ",new Date(e.end_date).toLocaleDateString()]})]})]})},e.id))})})})]}),s.jsx(c.Item,{name:"comment",label:"Комментарий",rules:[{required:!0,message:"Введите комментарий"}],children:s.jsx(M,{rows:4,placeholder:"Расскажите о себе, своих навыках и мотивации для этой практики...",maxLength:500,showCount:!0})}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #f0f0f0"},children:[s.jsx(f,{icon:s.jsx(j,{}),onClick:()=>{F(),l()},size:"large",style:{borderRadius:"12px",height:"48px",fontWeight:"600"},children:"Отмена"}),s.jsx(f,{type:"primary",htmlType:"submit",icon:s.jsx(_,{}),loading:d,size:"large",style:{borderRadius:"12px",height:"48px",fontWeight:"600",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:"Создать заявку"})]})]})]})}const{Title:G,Text:K}=x,N=e=>{if(!e)return(new Date).toISOString().split("T")[0];try{return e.split("T")[0]}catch(t){return(new Date).toISOString().split("T")[0]}};function U({preselectedCompany:n}){const{user:r,student:i}=t(),[l,d]=o.useState([]),[c,x]=o.useState(!1),[u,h]=o.useState(!1),[m,g]=o.useState(!1),[y,j]=o.useState(!1);o.useEffect(()=>{I()},[]),o.useEffect(()=>{if(n&&!y){const e=setTimeout(()=>{h(!0),j(!0)},100);return()=>clearTimeout(e)}},[n,y]),o.useEffect(()=>{n&&j(!1)},[n]);const I=()=>e(this,null,function*(){var e;x(!0);try{const t=(null==(e=(yield a.getApplications()).results)?void 0:e.map(e=>({id:e.id,company:e.company_name,position:e.position_name,status:e.status,appliedDate:N(e.applied_date||e.created_at),description:e.comment})))||[];d(t)}catch(t){p.error("Ошибка при загрузке заявок")}finally{x(!1)}}),_=t=>e(this,null,function*(){try{yield a.updateApplication(t.id,{status:"cancelled"}),p.success("Заявка отменена"),I()}catch(e){p.error("Ошибка при отмене заявки")}}),R=[{title:"Компания",dataIndex:"company",key:"company",width:250,render:(e,t)=>s.jsxs(D,{direction:"vertical",size:0,children:[s.jsx(K,{strong:!0,style:{fontSize:"16px"},children:e}),s.jsx(K,{type:"secondary",style:{fontSize:"14px"},children:t.position})]})},{title:"Статус",dataIndex:"status",key:"status",width:200,render:e=>(e=>{const t={pending:{color:"orange",text:"На рассмотрении"},accepted:{color:"green",text:"Одобрена"},rejected:{color:"red",text:"Отклонена"},cancelled:{color:"red",text:"Отменена"}}[e]||{color:"default",text:e};return s.jsx(T,{color:t.color,children:t.text})})(e),filters:[{text:"На рассмотрении",value:"pending"},{text:"Одобрена",value:"accepted"},{text:"Отклонена",value:"rejected"},{text:"Отменена",value:"cancelled"}],onFilter:(e,t)=>t.status===e},{title:"Дата подачи",dataIndex:"appliedDate",key:"appliedDate",render:e=>s.jsx(K,{children:new Date(e).toLocaleDateString("ru-RU")}),sorter:(e,t)=>new Date(e.appliedDate)-new Date(t.appliedDate)},{title:"Описание",dataIndex:"description",key:"description",width:300,render:e=>s.jsx(K,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e})},{title:"Действия",key:"actions",render:(e,t)=>"pending"===t.status&&s.jsx(f,{type:"text",danger:!0,icon:s.jsx(z,{}),onClick:()=>_(t),children:"Отменить"})}];return s.jsxs("div",{children:[s.jsxs(b,{style:{borderRadius:"20px",background:"linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",marginBottom:"24px"},children:[s.jsxs("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[s.jsxs("div",{children:[s.jsx(G,{level:2,style:{margin:0,color:"#2d3748"},children:"Мои заявки на практики"}),s.jsx(K,{type:"secondary",style:{fontSize:"16px"},children:"Здесь отображаются все ваши отправленные заявки на практики"})]}),s.jsx(f,{type:"primary",icon:s.jsx(v,{}),onClick:()=>{h(!0)},size:"large",style:{borderRadius:"12px",height:"48px",fontWeight:"600",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.3)"},children:"Новая заявка"})]}),s.jsx(S,{spinning:c,children:s.jsx(w,{columns:R,dataSource:l,rowKey:"id",pagination:!1,locale:{emptyText:s.jsx(C,{description:"У вас пока нет отправленных заявок",image:C.PRESENTED_IMAGE_SIMPLE,children:s.jsx(f,{type:"primary",size:"large",children:"Найти практики"})})},style:{background:"rgba(255, 255, 255, 0.5)",borderRadius:"12px"}})})]}),s.jsx(k,{title:null,open:u,closable:!1,footer:null,width:800,style:{borderRadius:"20px",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.2)"},styles:{mask:{backdropFilter:"blur(8px)",backgroundColor:"rgba(0, 0, 0, 0.3)"}},children:s.jsx(H,{onSave:e=>{e.company&&e.position?d(t=>[e,...t]):I(),h(!1)},onCancel:()=>{h(!1),j(!0)},loading:m,preselectedCompany:n})})]})}const{Content:V}=I,$={minHeight:"calc(100vh - 80px)",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",padding:"0",position:"relative"};function J(){var e;const t=R(),n=null==(e=E().state)?void 0:e.preselectedCompany;return s.jsxs(I,{style:{minHeight:"100vh"},children:[s.jsx(i,{}),s.jsx(V,{style:$,children:s.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"40px 24px"},children:[s.jsx(f,{icon:s.jsx(L,{}),onClick:()=>t("/"),size:"large",style:{marginBottom:"32px",borderRadius:"12px",height:"48px",fontWeight:"600",background:"linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%)",border:"1px solid rgba(255, 255, 255, 0.3)",color:"#667eea",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(10px)"},children:"Назад к главной"}),s.jsx(U,{preselectedCompany:n})]})})]})}export{J as default};
